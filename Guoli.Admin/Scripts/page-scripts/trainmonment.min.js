var TrainMoment=function(){function n(){}return n}(),ValidateResult=function(){function n(n,t,i){this.isValid=n;this.msg=t;this.element=i}return n}(),Page=function(){function n(){this.isFirstTime=$("input[name=IsFirstTime]").val()==="True";this.stationCount=$("input[name=StationCount]").val();this.errorClassName="error-tr"}return n.prototype.initComponents=function(){$(".pick-time:first").prop({readonly:!0,value:"始发站"}).removeAttr("data-field");$(".pick-time:last").prop({readonly:!0,value:"终点站"}).removeAttr("data-field");$("#dtBox").DateTimePicker()},n.prototype.save=function(){var n=this,t,i,r;$("."+n.errorClassName).removeClass(n.errorClassName);t=n.inputValidate();t.isValid?(i=n.getInputData(),r=n.dataFilter(i),n.submit(r)):(common.alert(t.msg),$(t.element).addClass(n.errorClassName))},n.prototype.submit=function(n){var t=JSON.stringify(n);common.ajax({url:"/Line/Save",data:{json:t}}).done(function(n){common.alert(n.msg);n.code==100&&(location.href="/Line/TrainNo")})},n.prototype.inputValidate=function(){var u=this,i=$(".train-moment"),f=i.length,n=!0,t="",r=null;return i.each(function(i){var e,o,s;if(r=this,e=u.buildEntity($(this)),i===0){if(!e.DepartTime)return n=!1,t="起点站的出发时间不能为空",!1}else if(i===f-1&&!e.ArriveTime)return n=!1,t="终点站的到达时间不能为空",!1;return(o=parseFloat(e.IntervalKms),e.IntervalKms&&(isNaN(o)||o<0))?(n=!1,t="您输出的区间公里不是有效的值",!1):(s=parseFloat(e.SuggestSpeed),e.SuggestSpeed&&(isNaN(s)||s<0)?(n=!1,t="您输入的建议车速不是有效的值",!1):void 0)}),new ValidateResult(n,t,r)},n.prototype.getInputData=function(){var t=this,i=$(".train-moment"),n=[];return i.each(function(i,r){var u=t.buildEntity($(r));n.push(u)}),n},n.prototype.dataFilter=function(n){var t;return this.isFirstTime?t=n:(t=[],n.forEach(function(n){n.Updated&&t.push(n)})),t},n.prototype.buildEntity=function(n){var t=new TrainMoment;t.Id=n.find("input[name=Id]").val();t.TrainNoLineId=n.find("input[name=TrainNoLineId]").val();t.TrainStationId=n.find("input[name=TrainStationId]").val();t.StopMinutes=n.find("input[name=StopMinutes]").val();t.IntervalKms=n.find("input[name=IntervalKms]").val();t.SuggestSpeed=n.find("input[name=SuggestSpeed]").val();t.Sort=n.find("input[name=Sort]").val();t.ArriveTime=n.find("input[name=ArriveTime]").val();t.DepartTime=n.find("input[name=DepartTime]").val();var i=n.find("input[name=ArriveTime]").data("orignal"),r=n.find("input[name=DepartTime]").data("orignal"),u=n.find("input[name=IntervalKms]").data("orignal"),f=n.find("input[name=SuggestSpeed]").data("orignal");return t.Updated=i!=t.ArriveTime||r!=t.DepartTime||u!=t.IntervalKms||f!=t.SuggestSpeed,t},n}();(function(n,t){t(function(){var n=new Page;n.initComponents();t("#btnSave").on("click",function(){n.save()});t("#btnBack").on("click",function(){location.href="/Line/TrainNo"})})})(window,jQuery);